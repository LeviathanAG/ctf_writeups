# AD1 Malware Hunters


**Flag:** `citadel{1ntr0duct10n_t0_v0l4t1l1ty_...}` 

we are given : 


- `challenge.ad1` 


## Tools Used

- **DogBOlT online decompiler** - Binary decompilation (for malware analysis - wouldve used ghidra if dogbolt wasnt hardclearing this ctf)
- **FTK Imager** - for looking through the disk image

- **Volatility 3** -  didnt use but did research on it
- **Autopsy** -  required a modoule to be installed  for .ad1 so didnt use this either

## Initial Analysis

###  Forensics Artifacts


when i opened the disk as an image file and go to downloads i can see an exe and some other files like ftk imager exe or sumn and 7zip ig. on further analysis :

###  File Name Analysis

The malware executable has a base64-encoded name:
```
Y2l0YWRlbHsxbnRyMGR1Y3QxMG5fdDBfdjBsNHQxbDF0eV8=
```

Decoding this gives us the first part of the flag:
```bash
$ echo "Y2l0YWRlbHsxbnRyMGR1Y3QxMG5fdDBfdjBsNHQxbDF0eV8=" | base64 -d
citadel{1ntr0duct10n_t0_v0l4t1l1ty_
```

**First flag part:** `citadel{1ntr0duct10n_t0_v0l4t1l1ty_`

This translates to: "Introduction to Volatility" (with l33t speak)

## Malware Code Analysis

###  Analyzing the Decompiled Code

The decompiled malware (`DecompiledMalware.c`) using dogbolt is a large file (19,615 lines) containing obfuscated code. Searching through it, we find an interesting function at line 317:

```c
char* sub_7ff7dd421670()
{
    char* result_1 = nullptr;
    uint64_t rax = sub_7ff7dd4215f0(
        "2a36363231786d6d252b362a37206c212d2f6d23273132232f3b333727272c316d2330273b2d372e2d2d292b2c25242d30362a2b316d202e2d206d2f232b2c6d262b27311d2b3023276c322c25", 
        &result_1);
    char* result = result_1;
    
    if (rax)
    {
        void* result_2 = result;
        void* r8_1 = &result[rax];
        
        if (rax & 1)
        {
            result_2 = &result[1];
            *result ^= 0x42;  // XOR operation!
        }
```

### Step 4: Decoding the Hex String

The malware contains a hex-encoded string that's decoded and XOR'd with `0x42`:

**Hex string:**
```
2a36363231786d6d252b362a37206c212d2f6d23273132232f3b333727272c316d2330273b2d372e2d2d292b2c25242d30362a2b316d202e2d206d2f232b2c6d262b27311d2b3023276c322c25
```

**Decoding script:**
```python
#!/usr/bin/env python3

hex_string = "2a36363231786d6d252b362a37206c212d2f6d23273132232f3b333727272c316d2330273b2d372e2d2d292b2c25242d30362a2b316d202e2d206d2f232b2c6d262b27311d2b3023276c322c25"

# Convert hex to bytes
data = bytes.fromhex(hex_string)
print(f"Raw data: {data}")

# XOR all bytes with 0x42 
result = bytes([b ^ 0x42 for b in data])
print(f"XOR 0x42: {result.decode('latin-1')}")
```

**Result:**
```
https://github.com/aespamyqueens/areyoulookingforthis/blob/main/dies_irae.png
```

github url when i open i get : 
![alt text](AD1.png)

### Finally we get : 
```
citadel{1ntr0duct10n_t0_v0l4t1l1ty_4nd_m4lw4r3_4n4lys1s_by_y0urs_truly}
```
script to do the xor but idts ts is imp

```
#!/usr/bin/env python3


hex_string = "2a36363231786d6d252b362a37206c212d2f6d23273132232f3b333727272c316d2330273b2d372e2d2d292b2c25242d30362a2b316d202e2d206d2f232b2c6d262b27311d2b3023276c322c25"


data = bytes.fromhex(hex_string)
print(f"{len(data)}")
print(f"{data}")
print(f"{data.decode('latin-1')}")

# The decompiled code shows XOR operations


#  XOR all bytes with 0x42
result2 = bytes([b ^ 0x42 for b in data])
print(f"\n2. All bytes XOR 0x42:")
print(f"   {result2.decode('latin-1', errors='replace')}")





print(f"    {hex_string}")
```


---
